{
    email admin@tuscany-photo-tours.com
}

tuscany-photo-tours.com {
    # HTTPS on standard port 443 (Caddy handles this automatically)
    # HTTP requests will be automatically redirected to HTTPS
    reverse_proxy pt-web:5174 {
        header_up Host {http.reverse_proxy.upstream.hostport}
        header_up X-Real-IP {http.request.remote.host}
        header_up X-Forwarded-For {http.request.remote.host}
        header_up X-Forwarded-Proto {http.request.scheme}
    }
    
    handle /general/* {
        reverse_proxy pt-general-go:8000 {
            header_up Host {http.reverse_proxy.upstream.hostport}
            header_up X-Real-IP {http.request.remote.host}
            header_up X-Forwarded-For {http.request.remote.host}
            header_up X-Forwarded-Proto {http.request.scheme}
        }
    }
    
    handle /general/health {
        reverse_proxy pt-general-go:8000/health {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
    
    handle /general/api-docs {
        reverse_proxy pt-general-go:8000/api-docs {
            header_up Host {http.reverse_proxy.upstream.hostport}
        }
    }
}

# Default server that catches all other hostnames
# :80 {
#     respond 444
# }

# Catch all HTTP requests and redirect to HTTPS
:80 {
    redir https://{host}{uri} permanent
}